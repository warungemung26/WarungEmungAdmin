<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title></title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/bottom-nav.css">



<style>
/* ====== STYLE TAB (STICKY) ====== */
.tabs {
  position: sticky;
  top: 0;
  z-index: 999;
  display: flex;
  border-bottom: 2px solid #ddd;
  margin-bottom: 15px;
  background: #fff;
  padding-top: 8px;
}

.tab {
  padding: 10px 16px;
  cursor: pointer;
  border: 1px solid #ddd;
  border-bottom: none;
  background: #f7f7f7;
  margin-right: 5px;
  border-radius: 6px 6px 0 0;
  font-weight: bold;
}
.tab.active { 
  background: #fff; 
  border-bottom: 2px solid white; 
}

.tab-content { display: none; }
.tab-content.active { display: block; }

/* Card wrapper */
.card {
  background: #fff;
  border: 1px solid #ccc;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 18px;
}

/* ======= MODAL ======= */
#confirmModal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,.55);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}
#confirmBox {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 350px;
  text-align: center;
}
#confirmBox button {
  padding: 10px 16px;
  margin: 8px;
  border-radius: 6px;
  cursor: pointer;
}
</style>
</head>
<body>

<h1></h1>

<!-- =============== MENU TAB =============== -->
<div class="tabs">	
<div class="tab active" data-tab="offline">ğŸ“¦ Data Offline</div>
<div class="tab" data-tab="flash">âš¡ Flash Sale</div>
<div class="tab" data-tab="repo">ğŸŒ Repo Manager</div>
<div class="tab" data-tab="token">ğŸ” Token</div>
</div>

<!-- ============================================================
     TAB 1 â€” DATA OFFLINE
============================================================ -->
<div id="tab-offline" class="tab-content active">

  <h2>ğŸ“¦ Kelola Data Offline</h2>

<!-- FORM TAMBAH -->
<div class="card">
  <h3>ğŸ›ï¸ Tambah Produk Baru</h3>
  <div class="admin-form">
    <input type="text" id="name" placeholder="Nama Produk"
           autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
    <input type="number" id="price" placeholder="Harga (Rp)"
           autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">

    <label>Kategori:</label>
    <select id="categorySelect" onchange="toggleCustomCategory(this)">
      <option value="">Pilih Kategori</option>
      <option value="sembako">Sembako</option>
      <option value="makanan">Makanan Cepat Saji</option>
      <option value="mie">Mie Instan</option>
      <option value="snack">Snack</option>
      <option value="minuman">Minuman</option>
      <option value="minumansachet">Obat</option>
      <option value="rumah">Rumah</option>
      <option value="custom">Custom...</option>
    </select>
    <input type="text" id="customCategory" placeholder="Tulis kategori baru..." style="display:none;"
           autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">

    <label>Gambar Produk:</label>
    <div style="display:flex; gap:10px;">
      <input type="text" id="imageName" placeholder="nama-file-gambar"
             autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      <button onclick="triggerFilePickerTemp()">ğŸ“ Pilih</button>
    </div>

    <button class="btn-add" onclick="addProduct()">+ Tambah Produk</button>
  </div>
</div>


  <!-- IMPORT JSON -->
  <div class="card">
    <h3>ğŸ“¥ Import JSON ke Tabel</h3>
    <textarea id="jsonInput" placeholder='Tempelkan array JSON di sini...' style="width:100%;height:120px;"></textarea>
    <button onclick="importJSON()">ğŸ“¤ Import</button>
    <button onclick="clearJSONInput()">ğŸ§¹ Bersihkan</button>
  </div>

  <!-- FILTER / SORT -->
  <div class="card">
    <h3>ğŸ” Filter & Sort Produk</h3>
    <select id="filterCategory" onchange="applyFilter()">
      <option value="">Semua Kategori</option>
    </select>

    <select id="sortOption" onchange="applyFilter()">
      <option value="">Tidak Diurutkan</option>
      <option value="nameAsc">Nama (Aâ€“Z)</option>
      <option value="nameDesc">Nama (Zâ€“A)</option>
      <option value="priceLow">Harga Termurah</option>
      <option value="priceHigh">Harga Termahal</option>
    </select>

    <input id="searchInput" placeholder="Cari..." oninput="applyFilter()">
    <button onclick="resetFilter()">ğŸ”„ Reset</button>
  </div>

<!-- ============================================================
     TABEL PRODUK OFFLINE
============================================================ -->

<!-- BARIS ATAS: IMPORT PRODUK LOKAL + HAPUS SEMUA -->
<div style="display:flex; gap:10px; margin-bottom:10px;">

    <!-- TOMBOL IMPORT TANPA LINK -->
    <button class="btn" onclick="loadProdukFromRepo()">ğŸ“¥ Import Produk</button>

    <!-- â˜…â˜…â˜… TOMBOL HAPUS SEMUA PRODUK â˜…â˜…â˜… -->
    <button class="btn" style="background:#ff3b30; color:white;" onclick="openConfirmDeleteAll()">ğŸ—‘ Hapus Semua</button>
</div>


<div class="card">
  <h3>ğŸ“‹ Data Produk (Offline)</h3>

  <div class="table-wrap">
    <table id="productTable">
      <thead>
        <tr>
          <th>No</th>
          <th>Nama Produk</th>
          <th>Harga</th>
          <th>Kategori</th>
          <th>Gambar</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

  <!-- OUTPUT JSON -->
  <div class="card">
    <button onclick="generateAndScrollJSON()">ğŸ’¾ Generate JSON</button>
    <button onclick="copyJSON()">ğŸ“‹ Copy</button>
    <pre id="jsonOutput">[ Kosong ]</pre>
  </div>
</div>

<div id="tab-flash" class="tab-content">
  <h2>âš¡ Kelola Flash Sale</h2>

  <div class="card">
    <h3>ğŸ“¥ Import JSON Flash Sale</h3>
    <textarea id="jsonFlashInput" style="width:100%;height:120px;"></textarea>
    <button onclick="importFlashJSON()">ğŸ“¤ Import</button>
    <button onclick="clearFlashJSONInput()">ğŸ§¹ Bersihkan</button>
  </div>

  <div class="card">
    <h3>âš¡ Flash Sale</h3>
    <div class="admin-form">
      <input type="text" id="flash_name" placeholder="Nama Produk">
      <input type="number" id="flash_price_normal" placeholder="Harga Normal">
      <input type="number" id="flash_price_flash" placeholder="Harga Flash">
      <input type="number" id="flash_stock" placeholder="Stok">
      <input type="text" id="flash_img" placeholder="URL Gambar">
      <input type="text" id="flash_label" placeholder="Deskripsi">
      <input type="text" id="flash_category" value="flash" readonly>
      <input type="datetime-local" id="flash_until">
      <button onclick="addFlashProduct()">â• Tambah Flash Sale</button>
    </div>
  </div>

  <table id="flashTable" border="1" style="width:100%; margin-top:10px;">
    <thead>
      <tr>
        <th>Nama</th>
        <th>Harga Normal</th>
        <th>Harga Flash</th>
        <th>Stok</th>
        <th>Label</th>
        <th>Flash Sampai</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="margin-top:10px;">
    <button onclick="importFlashJSON()">ğŸ“¥ Import JSON Lokal</button>
    <button onclick="downloadFlashJSON()">ğŸ“¤ Download JSON Flash</button>
  </div>
</div>


<!-- ============================================================
     TAB 2 â€” REPO MANAGER
============================================================ -->
<div id="tab-repo" class="tab-content">

  <h2>ğŸŒ Kelola Repo GitHub</h2>

  <div class="card">
    <h3>ğŸ“‚ Upload Gambar Massal</h3>
    <input type="file" id="filePicker" multiple accept="image/*">
    <button id="uploadMassalBtn">ğŸš€ Upload</button>
    <div id="previewArea"></div>
  </div>

  <div class="card">
    <h3>ğŸ—‚ï¸ Kelola Folder Repo</h3>
    <input id="folderPath" placeholder="nama-folder (misal: images)">
    <button id="loadFolder">ğŸ“‚ Load</button>
    <button id="deleteSelected">ğŸ—‘ï¸ Hapus Terpilih</button>
    <button id="deleteAll">ğŸ—‘ï¸ Hapus Semua</button>
    <button onclick="buatFolderBaru()">ğŸ“ Buat Folder Baru</button>

    <div id="fileList">
      <small>Menunggu load folder...</small>
    </div>
  </div>



  <div class="card">
    <h3>ğŸ“¤ Upload Produk JSON</h3>
    <button class="btn-upload" onclick="uploadJSONSimple()">ğŸš€ Upload produk.json</button>
    <button onclick="downloadJSON()">â¬‡ï¸ Download JSON</button>
    <button onclick="exportToExcel()">â¬‡ï¸ Export Excel</button>
  </div>

</div>

<!-- ============================================================
     TAB 3 â€” TOKEN
============================================================ -->
<div id="tab-token" class="tab-content">

  <h2>ğŸ” GitHub Token Manager</h2>

  <div class="card">
    <label>Token GitHub:</label>
    <input id="githubToken" type="password" placeholder="Masukkan token">

    <button id="btnPaste">ğŸ“‹ Paste</button>
    <button id="btnUseStored">ğŸ”‘ Pakai Token Tersimpan</button>
    <button id="btnSave">ğŸ’¾ Simpan (Encrypted)</button>
    <button id="btnSavePlain">ğŸ’¾ Simpan (Plain)</button>
    <button id="btnClearStored" style="color:red;">ğŸ—‘ Hapus Token</button>

    <input id="passphrase" type="password" placeholder="Passphrase optional">
  </div>

</div>

<!-- ============= MODAL KONFIRMASI ============= -->
<div id="confirmModal">
  <div id="confirmBox">
    <h3>âš  Hapus Semua Produk?</h3>
    <p>Semua data produk offline akan dihapus permanen.</p>

    <button style="background:#ff3b30; color:white;" onclick="deleteAllProducts()">Ya, hapus semua</button>
    <button onclick="closeConfirmDeleteAll()">Batal</button>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

  <!-- ================== JAVASCRIPT ================== -->
  <!-- Core / data -->
<script src="js/script.js"></script>
<script src="js/flash.js"></script>
<script src="js/bottom-nav.js"></script>

<!-- ================== NAVIGASI================== -->
<!-- Bottom nav default (produk biasa) -->
<div id="bottom-nav-normal" class="bottom-nav">
  <button class="nav-btn" onclick="scrollToProductInput()">ğŸ“ Input Produk</button>
  <button class="nav-btn" onclick="generateAndScrollJSON()">ğŸ’¾ Generate JSON</button>
  <button class="nav-btn" onclick="openConfirmDeleteAll()">ğŸ—‘ Hapus Semua</button>
  <button class="nav-btn" onclick="scrollToJSON()">ğŸ“¤ Import JSON Lokal</button>
  <button class="nav-btn github" onclick="loadProdukFromRepo()">ğŸŒ Import dari GitHub</button>
</div>

<!-- Bottom nav khusus Flash Sale (hidden default) -->
<div id="bottom-nav-flash" class="bottom-nav" style="display:none;">
  <button class="nav-btn" onclick="scrollToFlashInput()">ğŸ“ Input Flash</button>
  <button class="nav-btn" onclick="generateAndScrollFlashJSON()">ğŸ’¾ Generate JSON Flash</button>
  <button class="nav-btn" onclick="openConfirmDeleteFlash()">ğŸ—‘ Hapus Semua Flash</button>
  <button class="nav-btn" onclick="scrollToFlashJSON()">ğŸ“¤ Import JSON Flash</button>
</div>


<script>
// ====== TAB SWITCH + NAV SWITCH ======
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {

    // reset active
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));

    // aktifkan tab
    tab.classList.add("active");
    document.getElementById("tab-" + tab.dataset.tab).classList.add("active");

    // ====== SWITCH BOTTOM NAV ======
    const navNormal = document.getElementById("bottom-nav-normal");
    const navFlash  = document.getElementById("bottom-nav-flash");

    if (tab.dataset.tab === "offline") {
      navNormal.style.display = "flex";
      navFlash.style.display = "none";
    }
    else if (tab.dataset.tab === "flash") {
      navNormal.style.display = "none";
      navFlash.style.display = "flex";
    }
    else {
      // repo / token â†’ semua nav hilang
      navNormal.style.display = "none";
      navFlash.style.display = "none";
    }
  });
});


/* ============================================================
   MODAL HAPUS SEMUA PRODUK
============================================================ */

// buka modal
function openConfirmDeleteAll() {
  document.getElementById("confirmModal").style.display = "flex";
}

// tutup modal
function closeConfirmDeleteAll() {
  document.getElementById("confirmModal").style.display = "none";
}

// Hapus semua produk
function deleteAllProducts() {
  if (typeof products === "undefined") {
    alert("ERROR: Array 'products' tidak ditemukan!");
    return;
  }

  products.length = 0; // kosongkan array
  if (typeof renderTable === "function") renderTable();
  if (typeof generateJSON === "function") generateJSON();

  closeConfirmDeleteAll();
  showToast("Semua produk berhasil dihapus!");
}

</script>


<script>
// ==============================================
//  CONFIG REPO (UBAH JIKA PERLU)
// ==============================================
const owner  = "WarungEmung26";
const repo   = "WarungEmung";
const branch = "main";
const filePath = "data/produk.json"; // lokasi tetap


// ==============================================
//  IMPORT PRODUK DARI REPO (PAKAI TOKEN)
// ==============================================
async function importFromRepo() {
  const token = document.getElementById("githubToken") 
                ? document.getElementById("githubToken").value.trim()
                : "";

  if (!token) {
    alert("âš ï¸ Masukkan GitHub Token dulu!");
    return;
  }

  try {
    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}?ref=${branch}`;

    const res = await fetch(url, {
      headers: {
        "Authorization": `token ${token}`,
        "Accept": "application/vnd.github+json"
      }
    });

    if (!res.ok) {
      const errText = await res.text();
      throw new Error(`Gagal ambil file (HTTP ${res.status}) â†’ ${errText}`);
    }

    const meta = await res.json();

    if (!meta.content) throw new Error("File tidak memiliki konten.");

    // decode base64
    const decoded = atob(meta.content.replace(/\n/g, ""));
    let jsonData;

    try {
      jsonData = JSON.parse(decoded);
    } catch (e) {
      throw new Error("Isi produk.json bukan JSON valid: " + e.message);
    }

    if (!Array.isArray(jsonData)) {
      throw new Error("Format produk.json harus ARRAY.");
    }

    // map ke format internal
    products = jsonData.map(p => ({
      id: p.id || crypto.randomUUID(),
      name: p.name || "",
      price: Number(p.price || 0),
      category: p.category || "",
      img: p.img || p.image || ""
    }));

    saveLocal();
    renderTable();

    alert("âœ… Produk berhasil diimport dari GitHub!");
  } catch (err) {
    console.error("ERROR:", err);
    alert("âŒ Error import: " + err.message);
  }
}


// ==============================================
//  MODAL KONFIRMASI HAPUS SEMUA PRODUK
// ==============================================
function openConfirmDeleteAll() {
  if (confirm("âš ï¸ Yakin hapus SEMUA produk?")) {
    products = [];
    saveLocal();
    renderTable();
    alert("ğŸ—‘ Semua produk berhasil dihapus.");
  }
}


// ==============================================
//  FUNGSI WAJIB ADA (JIKA BELUM)
// ==============================================
function saveLocal() {
  localStorage.setItem("products", JSON.stringify(products));
}

function renderTable() {
  const tbody = document.querySelector("#productTable tbody");
  tbody.innerHTML = "";

  products.forEach((p, i) => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${p.name}</td>
      <td>${p.price}</td>
      <td>${p.category}</td>
      <td><img src="${p.img}" width="40"></td>
      <td><button onclick="deleteProduct('${p.id}')">Hapus</button></td>
    `;

    tbody.appendChild(tr);
  });
}

function deleteProduct(id) {
  products = products.filter(p => p.id !== id);
  saveLocal();
  renderTable();
}
</script>



</body>
</html>

